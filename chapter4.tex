\chapter{ПЛАНИРОВАНИЕ ПУТИ ДЛЯ СЛОЖНОЙ ТРАССЫ}\label{chap4}

В данной главе рассматривается задача планирования пути движения беспилотного автомобиля на многополосном шоссе. Приводится общее описание метода планирования. Рассматриваются результаты применения метода для многополосного шоссе.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Задача планирования пути}\label{2sec:problem-formulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	Решаемая задача состоит из следующих пунктов:
\begin{itemize}
\item Построение безопасных траекторий для беспилотного автомобиля при движении по шоссе, по которому вместе с ним движутся другие автомобили со скоростями в 18-27 м/с. 
\item Беспилотный автомобиль должен двигаться со скоростью как можно близкой к 22 м/с, что подразумевает обгон более медленных автомобилей.
\item Беспилотный автомобиль должен избегать любых столкновений с другими автомобилями и учитывать линии дорожной разметки при движении.
\item Автомобиль должен быть в состоянии осуществить полный круг по шоссе длинной 6946 м без происшествий.
\item Беспилотный автомобиль не должен испытывать ускорение более 10 м/$c^2$ и тряску более 10 м/$c^3$ для обеспечения комфортного путешествия для пассажиров.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Общая структура системы управления}\label{2sec:problem-formulation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	Используемый метод планирования пути может быть разделен на следующие подсистемы:
\begin{itemize}
\item Предсказания: используя данные сенсоров предсказывает траектории движения других автомобилей
\item Планирования поведения: определяет набор доступных маневров (изменение линии, ускорение, замедление и тд.)
\item Построения траекторий: для каждого из возможных маневров строится несколько траекторий движения
\item Оценки траекторий: для каждой траектории (в зависимости от доступности, безопасности, комфорта пассажиров, эффективности) определяется стоимость и на основе оценки выбирается наилучшая траектория.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Предсказания}\label{2sec:xxx} % xxx заменить на свою метку
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	В радиусе 70 м. определяем ближайшие к нам автомобили на всех полосах шоссе. Используя информацию, полученную с сенсоров, оцениваем скорость движения ближайших автомобилей. На основе текущего положения и оценки скорости для каждого из них определяется их траектория движения, которая в последствии используется для предотвращения столкновения с другими автомобилями и выбора наилучшей полосы (в зависимости от наличия машин в ней и их скоростей).
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Планирования поведения}\label{2sec:xxx} % xxx заменить на свою метку
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	В данной реализации при планировании поведения генерируется набор возможных маневров вместо единственного маневра. Маневром для текущей полосы движения будет изменение скорости таким образом чтобы поддерживать дистанцию в 30 м с впереди идущим автомобилем. Для всех остальных полос будут рассматриваться варианты движения с текущей скоростью ближайшего автомобиля полосы или большей скоростью. В последствии для каждого из возможных маневров будут построены траектории и при выборе оптимальной траектории будет так же выбран и оптимальный маневр.
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Построение траекторий}\label{2sec:xxx} % xxx заменить на свою метку
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	Построение траекторий происходит в системе координат Френе \cite{frenet} таким образом чтобы тряска была минимальной, что должно обеспечить максимальный комфорт для пассажиров.
	
	Тряска определяет как производная от ускорения т.е. данный метод нацелен на минимизацию третьей производной пути.
	
	Для минимизации тряски строится два многочлена 5 степени для продольного $s(t)$ и поперечного $d(t)$ движения автомобиля. На достаточно высоких скоростях многочлены могут быть построены независимо друг от друга без серьезного ухудшения качества траекторий. На низких скоростях их построение осложнено тем, что они должен быть построены совместно.
	
	Одной из проблем при построении траекторий является выбор начальной и конечной точек. Для обеспечения непрерывности траекторий начальная точка выбирается на уже построенном участке траектории. Важно заметить, что траектории строятся на следующую секунду движения (что позволяет эффективно избегать столкновений) и при этом обновляются каждые 20 мс (что позволяет учитывать новую информацию с сенсоров как только она поступила).
	
	После определения начала траектории необходимо определить её конец. Конец для поперечной траектории $d(t_f)$, где $t_f$ - время на которое траектория планируется, определяется как:
\begin{itemize}
\item $d(t_f)$: траектория заканчивается в центре выбранной полосы
\item $d'(t_f)=d''(t_f)=0$: в конце траектории поперечноедвижения заканчивается
\end{itemize}
	
	Для определения конца продольной части траектории $s(t_f)$ применяются следующие условия:
\begin{itemize}
\item $s''(t_f)=0$: ускорение отсутсвует
\item $s'(t_f)=v_f$: была достигнута целевая скорость
\end{itemize}

	После определения всех условий и нахождения возможных траекторий, для них производится оценка.
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Оценка траекторий}\label{2sec:xxx} % xxx заменить на свою метку
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%	
	Построенные траектории оцениваются по следующим параметрам:
\begin{itemize}
\item доступность: траектория не должна приводить к столкновениям
\item безопасность: управляемый автомобиль должен выдерживать безопасную дистанцию до других автомобилей
\item законность: не должны нарушаться скоростные ограничения
\item комфорт: тряска должна быть минимальной
\item эффективность: должна поддерживаться скорость близкая к целевой
\end{itemize}

	На основе этих параметров беспилотным автомобилем будут выбираться полосы, где есть свободное пространство или быстро движущиеся впереди автомобили. При этом любые перестроения будут осуществляться только с соблюдением безопасного расстояния до других участников движения.
	
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Результаты численных экспериментов}\label{2sec:xxx} % xxx заменить на свою метку
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	Для демонстрации работы полученного метода в численных экспериментах не учитывается физика автомобиля т.е. он всегда идеально следует построенным траекториям. Данное решение позволяет анализировать эффективность полученного метод без влияния помех, возникающих на уровне управления движением.
	
	В проведенных численных экспериментах было рассмотрено движение автомобиля вдоль кругового трехполосного шоссе. В результате чего были получены следующие диаграммы:
	
\includegraphics[width=\linewidth]{trajectoryScat.png}
	
	И графики:
	
\includegraphics[width=\linewidth]{trajectoryPlot.png}

	При исследовании полученных графиков надо понимать, что движение продолжалось на протяжении 10 мин из-за чего изменения скорости, ускорения и других параметров будут выглядеть довольно резкими. Диаграммы в данной ситуации предоставляют лучшее понимание об изменении параметров со временем, в то время как графики позволяют увидеть максимальные и минимальные значения измеряемых характеристик движения.
	
	При исследовании графика скорости видно, что на большей части пути удавалось поддерживать скорость близкую к целевой.
	
	При исследовании графика ускорения видно, что максимальное значение в 10 м/$c^2$ не было превышено. 
	
	При исследовании графика тряски видно, что значения по модулю не превышают 4 м/$c^3$, что существенно меньше желаемого ограничения в 10 м/$c^3$.
	
	При исследовании графика расстояния от правого края дороги видно, что автомобиль всегда оставался близко к центру выбранной полосы и успешно провел 16 перестроений.
	
	Исследование диаграмм показывает, что хотя резкие скачки параметров движения присутствуют, они не настолько существенны, как могло бы показаться из графиков.
	
	Важно помнить, что при добавлении полноценной системы управления движением резкие скачки скорости, а следовательно, и ускорения с тряской, сгладятся так как реальный автомобиль не может изменять свою скорость моментально.
\bigskip

Таким образом была рассмотрена задача планирования пути движения беспилотного автомобиля на многополосном шоссе. Приведено общее описание метода планирования. Рассмотрены результаты применения метода для многополосного шоссе.